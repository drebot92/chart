const generateId=()=>Math.round(1e6*Math.random()),roundUp=(e,t)=>{const s=Math.pow(10,t||0);return Math.ceil(e*s)/s},minMax=(e,t,s)=>Math.min(t,Math.max(e,s)),forEachKey=(e,t)=>Object.keys(e).forEach((s,n)=>t(s,e[s],n)),setAttributes=(e,t)=>forEachKey(t,(t,s)=>e.setAttribute(t,s)),setAttributesNS=(e,t)=>forEachKey(t,(t,s)=>e.setAttributeNS(null,t,s)),setStyle=(e,t)=>forEachKey(t,(t,s)=>{e.style[t]=s}),appendChilds=(e,t)=>t.forEach(t=>e.appendChild(t)),LineCarousel=function(e,t){const s=document.createElement("div");setAttributes(s,{class:"y-lines"}),appendChilds(s,[document.createElement("div"),document.createElement("div"),document.createElement("div")]),t&&setStyle(s,t);const n=s.childNodes,o="current y-lines__group",i=["down y-lines__group",o,"up y-lines__group"];n.forEach((t,s)=>{t.setAttribute("class",i[s]),e.forEach(e=>{const s=document.createElement("div");s.innerText=e,t.insertBefore(s,t.firstChild)})});const r=(e,t,s)=>(r,l)=>{r.setAttribute("class",i[l]);let a=0;if(s>0?a=l+s<=n.length-1?l+s:0:s<0&&(a=l+s>=0?l+s:n.length-1),a===t?r.setAttribute("style","transition: none;"):r.removeAttribute("style"),i[l]===o){const t=r.childNodes;e.forEach((e,s)=>{t[t.length-1-s].innerText=e})}};this.up=(e=>{const t=i.indexOf(o);i.unshift(i.pop()),n.forEach(r(e,t,1))}),this.down=(e=>{const t=i.indexOf(o);i.push(i.shift()),n.forEach(r(e,t,-1))}),this.node=s},Labels=function(e,t){const s=document.createElement("div"),n=document.createElement("div"),o=document.createElement("style"),i=`scroll-group-${generateId()}`;s.appendChild(n),s.setAttribute("class","x-labels"),n.setAttribute("class",`x-labels__scroll-group ${i}`),t&&setStyle(s,t),e.forEach(e=>{const t=document.createElement("div");t.innerText=e,n.appendChild(t)});let r=n.scrollWidth;let l=Math.floor(r/100);s.appendChild(o);this.updateWidth=(()=>{const t=n.scrollWidth;r!==t&&(r=t);const s=Math.floor(r/100);if(l!==s){l=s,(e=>{o.innerHTML=`\n      .x-labels__scroll-group > div {\n        opacity: 0;\n      }\n      .x-labels__scroll-group.${i} > div:nth-child(${e}n+1) {\n        opacity: 1;\n      }\n    `})(Math.floor(e.length/l))}}),this.setPosition=((t,s)=>{this.updateWidth();const o=e.length-1,i=1/s*100,r=i/o;setStyle(n,{width:`${i+r}%`,transform:`translateX(${-(100*(t-t/o))}%)`,left:`${-r/2}%`})}),this.node=s},Tooltips=function(e,t,s,n){const o=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),l=document.createElement("div");o.appendChild(i),i.appendChild(r),o.setAttribute("class","tooltips"),i.setAttribute("class","tooltips__scroll-group"),r.setAttribute("class","tooltips__hilight"),l.setAttribute("class","tooltips__tooltip");let a=0;const c=[],d=[],h=document.createElement("span");l.appendChild(h),t.forEach((e,t)=>{const s=document.createElement("div"),n=document.createElement("span");s.setAttribute("class","tooltips__point"),n.setAttribute("class","tooltips__value"),c[t]=s,d[t]=n,r.appendChild(s),l.appendChild(n)}),r.appendChild(l);n&&setStyle(o,n),o.addEventListener("mouseenter",()=>{o.classList.add("tooltips--active")}),o.addEventListener("mouseleave",()=>{o.classList.remove("tooltips--active")}),e.forEach((n,o)=>{const l=document.createElement("div");l.addEventListener("mouseover",()=>{const n=l.offsetLeft,i=l.offsetWidth;setStyle(r,{left:`${n+i/2}px`}),(n=>{h.innerText=e[n],t.forEach((e,t)=>{d[t].innerHTML=`<span>${e[n+1]}</span>${e[0]}`;const o=e[n+1]/a*100;setStyle(c[t],{"border-color":s[e[0]],bottom:`${o}%`}),d[t].style.color=s[e[0]]})})(o)}),i.appendChild(l)}),this.setPosition=((t,s,n)=>{a=n;const o=e.length-1,r=1/s*100,l=r/o;setStyle(i,{width:`${r+l}%`,transform:`translateX(${-(100*(t-t/o))}%)`,left:`${-l/2}%`})}),this.node=o},RangeSelector=function(e){const t={width:0,left:0,leftPercent:0,right:0,value:0,widthPercent:1},s={offsetX:0,startX:0};let n=0,o=0,i=0,r=0,l=()=>{};const a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),h=document.createElement("div"),u=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div");a.setAttribute("class","range-controls"),a.style.display="grid",a.style.gridTemplateColumns="0px 1fr 0px",e&&setStyle(a,e),c.setAttribute("class","range-controls__area"),d.setAttribute("class","range-controls__area-handle"),h.setAttribute("class","range-controls__handle"),u.setAttribute("class","range-controls__handle"),p.setAttribute("class","range-controls__overflow"),m.setAttribute("class","range-controls__overflow"),appendChilds(c,[h,d,u]),appendChilds(a,[p,c,m]);let f=null;const g=e=>{null!==f&&(e.touches?s.offsetX=e.touches[0].clientX-s.startX:s.offsetX=e.clientX-s.startX,t.width=t.width||a.offsetWidth,i=t.width-80-t.right,r=t.width-80-t.left,"left"===f&&(t.left=minMax(0,i,n+s.offsetX),t.leftPercent=t.left/t.width),"right"===f&&(t.right=minMax(0,r,o-s.offsetX)),t.value=t.width-t.right-t.left,t.widthPercent=t.value/t.width,"area"===f&&(t.left=minMax(0,t.width-t.value,n+s.offsetX),t.leftPercent=t.left/t.width,t.right=minMax(0,t.width-t.value,o-s.offsetX)),a.style.gridTemplateColumns=`${t.left}px 1fr ${t.right}px`,l(t))},v=()=>{null!==f&&(n=t.left,o=t.right),f=null,s.startX=0},b=e=>t=>{f=e,t.touches?s.startX=t.touches[0].clientX:s.startX=t.clientX},w=b("area"),E=b("left"),y=b("right"),_=(e,t,s)=>t.split(" ").forEach(t=>e.addEventListener(t,s)),A=(e,t,s)=>t.split(" ").forEach(t=>e.removeEventListener(t,s));_(h,"mousedown touchstart",E),_(d,"mousedown touchstart",w),_(u,"mousedown touchstart",y),_(a,"touchmove",g),_(a,"touchend",v);const x=()=>{A(window,"mousemove",g),A(window,"mouseup",v),A(window,"mouseup",x)};_(a,"mouseenter",()=>{_(window,"mousemove",g),_(window,"mouseup",v)}),_(window,"mouseleave",x),this.node=a,this.range=t,this.onChange=(e=>{l=e})},LegendCheckboxes=function(e,t,s){const n=document.createElement("div");let o=()=>{};n.setAttribute("class","legend"),forEachKey(e,(e,s)=>{const i=document.createElement("label"),r=document.createElement("input"),l=document.createElement("span");setAttributes(i,{class:"legend__label",style:""}),l.innerHTML=`\n      <i class='check' style='background-color: ${t[e]};'></i>\n      <span>${s}</span>\n    `,setAttributes(r,{type:"checkbox",value:e,title:s,checked:"true"}),r.addEventListener("change",e=>{o(e.target.value,e.target.checked)}),i.appendChild(r),i.appendChild(l),n.appendChild(i)}),s&&setStyle(n,s),this.onChange=(e=>{o=e}),this.node=n},Chart=function(e,{data:t,previewHeight:s}){const n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",i=document.createElement("div"),r={node:document.createElementNS(n,"svg"),symbol:document.createElementNS(n,"symbol")},l={node:document.createElement("div"),svg:document.createElementNS(n,"svg"),use:document.createElementNS(n,"use"),height:50,strokeWidth:1},a={node:document.createElement("div"),svg:document.createElementNS(n,"svg"),use:document.createElementNS(n,"use"),height:s||300,strokeWidth:2},c=e=>e/864e5,d=t.types,h=t.names,u=t.colors,p=[];let m=[],f=[],g=[],v=[],b=0,w=1;t.columns.forEach(e=>{const[t,...s]=e;if("x"===d[t])return g=s,void(v=s.map(e=>new Date(e).toDateString().split(" ").splice(1,2).join(" ")));f=f.length>0?f.concat([e]):[].concat([e])});const E=(e,t)=>{const s=f.flatMap(([s,...n])=>m.includes(s)?[]:n.splice(e,t-e)),n=Math.max(...s),o=n.toString().length-2,i=roundUp(n/6,-o),r=[];for(let e=0;e<6;e++)r[e]=i*e;return{start:0,end:n,steps:r,step:i}},y={...((e,t)=>{const s=g[e],n=g[t];return{start:s,end:n,range:n-s,formattedStart:c(s),formattedEnd:c(n),formattedRange:c(n-s)}})(0,g.length-1)},_={...E(0,g.length-1)};let A=_,x={x:0,width:y.formattedRange,transform:"scale(1, 1)"};const C=new LineCarousel(A.steps,{height:`${a.height}px`,width:"100%",position:"absolute",top:"0px"});a.yLines=C.node;const S=new Labels(v);a.labels=S.node;const $=new Tooltips(v,f,u);a.tooltips=$.node;const L=new RangeSelector;l.selector=L.node;const N=new LegendCheckboxes(h,u),k=()=>{const e=`chart-${generateId()}`;r.symbol.id=e,a.use.setAttributeNS(o,"xlink:href",`#${e}`),l.use.setAttributeNS(o,"xlink:href",`#${e}`),setAttributesNS(r.node,{style:"display: none;"}),setAttributesNS(r.symbol,{viewBox:`${y.formattedStart} ${-_.end} ${y.formattedRange} ${_.end}`,preserveAspectRatio:"none"}),f.forEach(([e,...t],s)=>{const o=document.createElementNS(n,"polyline"),i=t.map((e,t)=>[c(g[t]),-e]).join(" ");setAttributesNS(o,{points:i,stroke:u[e],"vector-effect":"non-scaling-stroke",fill:"none"}),r.symbol.appendChild(o),p[s]=o}),r.node.appendChild(r.symbol)},M=(e=b,t=w)=>{b=e,w=t;const s=y.start+y.range*e,n=y.start+y.range*(e+t),o=minMax(0,g.length-1,g.findIndex(e=>e>=s)-1),i=minMax(0,g.length-1,g.findIndex(e=>e>=n)+1),r={...E(o,i)};A.end<r.end?(C.up(r.steps),A=r):A.end>r.end&&(C.down(r.steps),A=r);const l=`${1/t*100}%`,c=`${-e/t*100}%`,d=`scale(1, ${_.end/(A.steps[5]+A.step)})`;S.setPosition(e,t),$.setPosition(e,t,A.steps[5]+A.step),setAttributesNS(a.use,{...x.x!==c&&{x:c},...x.width!==l&&{width:l},...x.transform!==d&&{transform:d}}),x={x:c,width:l,transform:d}};return setAttributes(i,{class:"chart",style:"position:relative;"}),k(),a.node.setAttribute("class","chart__preview"),setAttributesNS(a.svg,{height:a.height,width:"100%",preserveAspectRatio:"none","stroke-width":a.strokeWidth}),setAttributesNS(a.use,{x:`${100*b}%`,y:0,width:`${100*w}%`,"transform-origin":"bottom",style:"transition: transform .3s;"}),a.svg.appendChild(a.use),appendChilds(a.node,[a.svg,a.yLines,a.tooltips]),l.node.setAttribute("class","chart__selector"),setAttributesNS(l.svg,{height:l.height,"stroke-width":l.strokeWidth,preserveAspectRatio:"none",width:"100%"}),setAttributesNS(l.use,{x:0,y:0,height:l.height,style:"transition: transform .3s;"}),l.svg.appendChild(l.use),appendChilds(l.node,[l.svg,l.selector]),appendChilds(i,[r.node,a.node,a.labels,l.node,N.node]),e.appendChild(i),M(),S.updateWidth(),L.onChange(({leftPercent:e,widthPercent:t})=>M(e,t)),N.onChange((e,t)=>{m=t?m.filter(t=>t!==e):m.concat(e),f.forEach((e,t)=>{setAttributesNS(p[t],{style:m.includes(e[0])?"opacity: 0;":"opacity: 1;"})}),M(),(()=>{const e=`scale(1, ${1/(A.end/_.end)})`;setAttributesNS(l.use,{x:0,y:0,height:l.height,"stroke-width":l.strokeWidth,transform:e,"transform-origin":"bottom"})})(),Object.keys(h).every(e=>m.includes(e))?(a.node.classList.add("chart__preview--empty"),l.node.classList.add("chart__selector--empty"),C.up(["","","","","",""])):(a.node.classList.remove("chart__preview--empty"),l.node.classList.remove("chart__selector--empty"),C.up(A.steps))}),this};